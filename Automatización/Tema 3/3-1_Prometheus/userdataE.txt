#!/bin/bash
# Actualizar el sistema
sudo yum update -y

# Descargar la última versión de Node Exporter
cd /tmp
wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz

# Extraer los archivos
tar xvfz node_exporter-1.6.1.linux-amd64.tar.gz
sudo mv node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/

# Crear un usuario para Node Exporter
sudo useradd --no-create-home --shell /bin/false nodeusr

# Crear archivo de servicio para Node Exporter
cat <<EOF | sudo tee /etc/systemd/system/node_exporter.service
[Unit]
Description=Node Exporter
After=network.target

[Service]
User=nodeusr
ExecStart=/usr/local/bin/node_exporter

[Install]
WantedBy=default.target
EOF

# Dar permisos adecuados
sudo chown nodeusr:nodeusr /usr/local/bin/node_exporter

# Iniciar Node Exporter y habilitarlo para que se inicie automáticamente
sudo systemctl daemon-reload
sudo systemctl start node_exporter
sudo systemctl enable node_exporter

# Confirmación de que el servicio ha iniciado
echo "Node Exporter está corriendo y escuchando en el puerto 9100"
